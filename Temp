
# 9. gap이 발생한 위치에 수직선과 "gap joined" 텍스트 추가
for idx in gap_indices:
    # gap은 idx-1와 idx 사이에서 발생하므로 중간값을 사용
    x_gap = (df_comb.loc[idx-1, 'x_cont'] + df_comb.loc[idx, 'x_cont']) / 2
    ax.axvline(x=x_gap, color='grey', linestyle='--', alpha=0.7)
    ax.text(x_gap, ax.get_ylim()[1], 'gap joined', color='grey',
            ha='center', va='top', rotation=90, fontsize=8)

# 10. tick label에 gap 발생 지점을 반드시 표시하기 위해 base tick과 gap 인덱스를 모두 포함
n_ticks = 10
base_ticks = np.linspace(0, df_comb['x_cont'].iloc[-1], n_ticks, dtype=int)
# base_ticks와 gap_indices의 합집합을 생성한 후 정렬
ticks = sorted(set(base_ticks.tolist() + gap_indices))
tick_labels = []
for t in ticks:
    label = df_comb.loc[t, 'DATE_TIME'].strftime('%Y-%m-%d\n%H:%M')
    # 만약 이 tick이 gap 바로 시작하는 지점이면 label에 (gap) 표시 추가
    if t in gap_indices:
        label += "\n(gap)"
    tick_labels.append(label)

ax.set_xticks(ticks)
ax.set_xticklabels(tick_labels)
